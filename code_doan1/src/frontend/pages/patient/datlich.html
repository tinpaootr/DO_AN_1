<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Đặt lịch khám</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<style>
    body {
        background-color: #f5f8fa;
        font-family: 'Segoe UI', sans-serif;
    }

    .booking-container {
        max-width: 950px;
        margin: 60px auto;
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.1);
        padding: 40px;
    }

    .form-title {
        text-align: center;
        color: #00AEEF;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 30px;
    }

    /* Thong tin benh nhan */
    .profile-card-select {
        border: 2px solid #ccc;
        border-radius: 8px;
        padding: 15px;
        transition: all 0.3s;
        cursor: pointer;
    }

    .profile-card-select:hover,
    .profile-card-select.active {
        border-color: #007bff;
        box-shadow: 0 0 10px rgba(0, 123, 255, 0.2);
    }

    .section-title {
        font-weight: 600;
        color: #008ecb;
        border-left: 4px solid #00AEEF;
        padding-left: 10px;
        margin-bottom: 15px;
    }

    .btn-submit {
        background-color: #00AEEF;
        border: none;
        font-weight: 600;
    }

    .btn-submit:hover {
        background-color: #008ecb;
    }
</style>

<body>

    <!-- Navbar -->
    <div class="sticky-top">
        <div id="navbar"></div>
    </div>
    <script>
        // Dùng fetch để load file header.html 
        fetch("../../components/navbar.html")
            .then(res => res.text())
            .then(data => document.getElementById("navbar").innerHTML = data);
    </script>

    <div class="booking-container">
        <h3 class="form-title">Đặt Lịch Khám</h3>

        <!-- Thông tin cá nhân -->
        <div class="mb-4">
            <h5 class="section-title">Thông tin bệnh nhân</h5>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="profile-card-select active" data-profile-id="1">
                        <input class="visually-hidden" type="radio" name="profile" id="p1" checked>
                        <label for="p1" class="w-100">
                            <span class="fw-bold d-block">Trịnh Thị Yến Nhi</span>
                            <small class="text-muted">Ngày sinh: 25/03/2005</small>
                            <span class="badge bg-success float-end">Đang chọn</span>
                        </label>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="profile-card-select" data-profile-id="2">
                        <input class="visually-hidden" type="radio" name="profile" id="p2">
                        <label for="p2" class="w-100">
                            <span class="fw-bold d-block">Nguyễn Văn Khang</span>
                            <small class="text-muted">Ngày sinh: 01/01/1980</small>
                        </label>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <button type="button"
                        class="btn btn-outline-primary h-100 w-100 d-flex flex-column align-items-center justify-content-center">
                        <i class="fas fa-plus-circle fs-3 mb-2"></i>
                        Tạo Hồ Sơ Mới
                    </button>
                </div>
            </div>
        </div>

        <!-- Thông tin bệnh nhân -->

        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label class="form-label">Họ và tên</label>
                <input type="text" class="form-control" id="name" placeholder="VD: Nguyễn Văn A"
                    value="Trịnh Thị Yến Nhi">
            </div>
            <div class="col-md-6">
                <label class="form-label">Số điện thoại</label>
                <input type="text" class="form-control" id="phone" placeholder="VD: 090xxxxxxx" value="036xxxx663">
            </div>
            <div class="col-md-6">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="email" placeholder="email@gmail.com"
                    value="yenni@example.com">
            </div>
            <div class="col-md-6">
                <label class="form-label">Ngày sinh</label>
                <input type="date" class="form-control" id="birth" value="2005-03-25">
            </div>
            <div class="col-md-12">
                <label class="form-label">Địa chỉ</label>
                <input type="text" class="form-control" id="address" placeholder="Nhập địa chỉ" value="Cần Thơ">
            </div>
        </div>

        <!-- Gói khám -->
        <div class="mb-4">
            <h5 class="section-title">Chọn gói khám</h5>
            <select class="form-select" id="packageSelect">
                <option selected disabled>-- Chọn gói khám --</option>
                <option value="tongquat">Gói khám tổng quát</option>
                <option value="timmach">Gói khám tim mạch</option>
                <option value="tieuduong">Gói khám tiểu đường</option>
                <option value="phukhoa">Gói khám phụ khoa</option>
            </select>
        </div>
        <!-- Bác sĩ & thời gian -->
        <div class="mb-4">
            <h5 class="section-title">Chọn bác sĩ & Thời gian</h5>

            <div id="doctorDisplay" style="display: none;">
            </div>

            <div id="scheduleDisplay" class="mt-4" style="display: none;">
                <h6 class="section-title">Chọn Khung Giờ</h6>
            </div>

            <div id="selectPackagePrompt" class="alert alert-info text-center">
                Vui lòng chọn một gói khám để hiển thị danh sách bác sĩ và lịch trống.
            </div>

        </div>

        <!-- Ghi chú -->
        <div class="mb-4">
            <h5 class="section-title">Ghi chú (nếu có)</h5>
            <textarea class="form-control" rows="3" placeholder="Nhập ghi chú hoặc yêu cầu đặc biệt..."></textarea>
        </div>

        <div class="text-center mt-4">
            <button class="btn btn-submit px-5 py-2 rounded-pill">Gửi yêu cầu đặt lịch</button>
        </div>
    </div>
    </div>

    <!-- Footer -->
    <div id="footer"></div>
    <script>
        // Dùng fetch để load file header.html 
        fetch("../../components/footer.html")
            .then(res => res.text())
            .then(data => document.getElementById("footer").innerHTML = data);
    </script>


    <!-- Bootstrap Icons -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <script>
        // JS cho việc chọn thẻ hồ sơ (profile)
        document.querySelectorAll('.profile-card-select').forEach(card => {
            card.addEventListener('click', function () {
                document.querySelectorAll('.profile-card-select').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                // Cần cập nhật trạng thái radio button (nếu có)
            });
        });
    </script>

    <script>
        const patientData = {
            1: {
                name: 'Trịnh Thị Yến Nhi',
                phone: '036xxxx663',
                email: 'yenni@example.com',
                birth: '2005-03-25',
                address: 'Cần Thơ'
            },
            2: {
                name: 'Nguyễn Văn Khang',
                phone: '090xxxx123',
                email: 'khangnv@example.com',
                birth: '1980-01-01',
                address: 'Hà Nội'
            }
        };

        function updatePatientForm(profileId) {
            const data = patientData[profileId];
            if (!data) return;
            document.getElementById('name').value = data.name;
            document.getElementById('phone').value = data.phone;
            document.getElementById('email').value = data.email;
            document.getElementById('birth').value = data.birth;
            document.getElementById('address').value = data.address;
        }

        document.querySelectorAll('.profile-card-select').forEach(card => {
            card.addEventListener('click', function () {
                // Xóa active + badge "Đang chọn" khỏi tất cả card
                document.querySelectorAll('.profile-card-select').forEach(c => {
                    c.classList.remove('active', 'border-primary', 'border-2');
                    let badge = c.querySelector('.badge');
                    if (badge) badge.remove(); // Xóa badge cũ
                });

                // Thêm active + viền cho card đang chọn
                this.classList.add('active', 'border-primary', 'border-2');

                // Thêm badge "Đang chọn" nếu chưa có
                let badge = this.querySelector('.badge');
                if (!badge) {
                    badge = document.createElement('span');
                    badge.className = 'badge bg-success float-end';
                    this.querySelector('label').appendChild(badge);
                }
                badge.textContent = 'Đang chọn';

                // Cập nhật form
                const profileId = this.dataset.profileId;
                updatePatientForm(profileId);

                // Cập nhật radio button
                const radio = this.querySelector('input[type=radio]');
                if (radio) radio.checked = true;
            });
        });

        // Khởi tạo form với hồ sơ đang active lúc load trang
        const activeProfile = document.querySelector('.profile-card-select.active');
        if (activeProfile) {
            updatePatientForm(activeProfile.dataset.profileId);
            let badge = activeProfile.querySelector('.badge');
            if (!badge) {
                badge = document.createElement('span');
                badge.className = 'badge bg-success float-end';
                activeProfile.querySelector('label').appendChild(badge);
            }
            badge.textContent = 'Đang chọn';
        }
    </script>





    <script>
        // Dữ liệu bác sĩ và lịch khám (Giả lập Backend Data)
        const doctorData = {
            // --------------------------------------------------------------------
            // GÓI KHÁM TỔNG QUÁT (Value: tongquat)
            // --------------------------------------------------------------------
            'tongquat': [
                {
                    id: 'DQ101',
                    name: 'BS. Trần Văn Đức',
                    specialty: 'Nội Tổng Quát (10 năm KN)',
                    times: [
                        '08:00', // 8h sáng
                        '09:00',
                        '14:00', // 2h chiều
                        '15:00',
                        '16:00'
                    ]
                },
                {
                    id: 'DQ102',
                    name: 'BSCKI. Lê Thị Mai',
                    specialty: 'Nội Cơ Xương Khớp',
                    times: [
                        '11:00', // 11h sáng
                        '13:30', // 1h30 chiều
                        '14:30'
                    ]
                }
            ],

            // --------------------------------------------------------------------
            // GÓI KHÁM TIM MẠCH (Value: timmach)
            // --------------------------------------------------------------------
            'timmach': [
                {
                    id: 'DT201',
                    name: 'PGS. TS. Hoàng Anh',
                    specialty: 'Tim Mạch Chuyên sâu (Trưởng khoa)',
                    times: [
                        '08:30',
                        '09:30',
                        '16:30' // 4h30 chiều
                    ]
                },
                {
                    id: 'DT202',
                    name: 'ThS. BS. Nguyễn Minh Trí',
                    specialty: 'Tim Mạch Can thiệp',
                    times: [
                        '10:30',
                        '11:30',
                        '14:00'
                    ]
                }
            ],

            // --------------------------------------------------------------------
            // GÓI KHÁM TIỂU ĐƯỜNG (Value: tieuduong)
            // --------------------------------------------------------------------
            'tieuduong': [
                {
                    id: 'DD301',
                    name: 'BSCKII. Nguyễn Việt Cường',
                    specialty: 'Nội Tiết & Tiểu đường',
                    times: [
                        '13:00',
                        '14:30',
                        '15:30'
                    ]
                }
            ],

            // --------------------------------------------------------------------
            // GÓI KHÁM PHỤ KHOA (Value: phukhoa)
            // --------------------------------------------------------------------
            'phukhoa': [
                {
                    id: 'DP401',
                    name: 'TS. BS. Trần Thị Dung',
                    specialty: 'Sản Phụ khoa',
                    times: [
                        '07:30',
                        '08:30',
                        '09:30',
                        '10:30'
                    ]
                }
            ]
        };

        const packageSelect = document.getElementById('packageSelect');
        const doctorDisplay = document.getElementById('doctorDisplay');
        const scheduleDisplay = document.getElementById('scheduleDisplay');
        const selectPrompt = document.getElementById('selectPackagePrompt');
        const timeSlotsContainer = document.createElement('div'); // Khối chứa nút giờ

        // --------------------------------------------------------------------
        // HÀM 1: HIỂN THỊ BÁC SĨ VÀ KÍCH HOẠT CHỌN
        // --------------------------------------------------------------------
        function renderDoctors(packageId) {
            const doctors = doctorData[packageId];
            let doctorCardsHtml = '<div class="row g-3">';

            doctors.forEach(doc => {
                doctorCardsHtml += `
                <div class="col-md-6">
                    <div class="card p-3 shadow-sm doctor-card" data-doctor-id="${doc.id}">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-user-md me-3 fs-4 text-primary"></i>
                            <div>
                                <h6 class="mb-0 fw-bold">${doc.name}</h6>
                                <small class="text-muted">${doc.specialty}</small>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary ms-auto btn-select-doctor" data-doc-id="${doc.id}">Chọn</button>
                        </div>
                    </div>
                </div>
            `;
            });

            doctorCardsHtml += '</div>';
            doctorDisplay.innerHTML = doctorCardsHtml;
            doctorDisplay.style.display = 'block';
            scheduleDisplay.style.display = 'none'; // Ẩn lịch khi chọn lại gói mới

            // Gán sự kiện cho các nút 'Chọn' bác sĩ
            document.querySelectorAll('.btn-select-doctor').forEach(btn => {
                btn.addEventListener('click', function () {
                    // Xóa active khỏi tất cả các card
                    document.querySelectorAll('.doctor-card').forEach(c => c.classList.remove('active', 'border-primary', 'border-2'));
                    // Thêm active vào card đang chọn
                    this.closest('.doctor-card').classList.add('active', 'border-primary', 'border-2');

                    const selectedDocId = this.dataset.docId;
                    renderSchedule(selectedDocId, packageId);
                });
            });
        }

        // --------------------------------------------------------------------
        // HÀM 2: HIỂN THỊ KHUNG GIỜ
        // --------------------------------------------------------------------
        function renderSchedule(docId, packageId) {
            const selectedDoctor = doctorData[packageId].find(doc => doc.id === docId);
            let timeSlotsHtml = '<div class="mb-3">Chọn ngày (Tạm thời bỏ qua)</div>'; // Thêm input date ở đây

            // Khởi tạo khối chứa nút giờ
            timeSlotsContainer.innerHTML = '';
            timeSlotsContainer.className = 'd-flex flex-wrap gap-2';

            selectedDoctor.times.forEach(time => {
                timeSlotsContainer.innerHTML += `
                <button type="button" class="btn btn-outline-success time-slot-btn" data-time="${time}">
                    ${time} - ${parseInt(time.split(':')[0]) + 1}:00
                </button>
            `;
            });

            scheduleDisplay.innerHTML = '<h6 class="section-title">Chọn Khung Giờ Khám (Có sẵn)</h6>';
            scheduleDisplay.appendChild(timeSlotsContainer);
            scheduleDisplay.style.display = 'block';

            // Gán sự kiện chọn giờ
            document.querySelectorAll('.time-slot-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.time-slot-btn').forEach(b => b.classList.remove('active', 'btn-success'));
                    this.classList.add('active', 'btn-success');
                    // TODO: Kích hoạt nút gửi yêu cầu đặt lịch
                });
            });
        }

        // --------------------------------------------------------------------
        // SỰ KIỆN CHÍNH: KHI GÓI KHÁM THAY ĐỔI
        // --------------------------------------------------------------------
        packageSelect.addEventListener('change', function () {
            const selectedPackage = this.value;
            selectPrompt.style.display = 'none';

            if (selectedPackage && doctorData[selectedPackage]) {
                renderDoctors(selectedPackage);
            } else {
                doctorDisplay.style.display = 'none';
                scheduleDisplay.style.display = 'none';
            }
        });

        // Giữ lại JS cũ cho phần hồ sơ cá nhân
        document.querySelectorAll('.profile-card-select').forEach(card => {
            card.addEventListener('click', function () {
                document.querySelectorAll('.profile-card-select').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                // Cần cập nhật trạng thái radio button (nếu có)
            });
        });
    </script>


</body>

</html>