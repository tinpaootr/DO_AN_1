<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng Ký - Eden Health</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .navbar-custom {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px 0;
        }

        .navbar-brand-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            text-decoration: none;
        }

        .navbar-brand-header i {
            color: #667eea;
        }

        .navbar-brand-header .custom-primary-color {
            color: #667eea;
        }

        .register-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 80px);
            padding: 40px 20px;
        }

        .register-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            max-width: 1100px;
            width: 100%;
            display: flex;
            min-height: 650px;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .register-left {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .register-left::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            top: -100px;
            left: -100px;
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .register-left .icon {
            font-size: 5rem;
            margin-bottom: 30px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .register-left h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .register-left p {
            font-size: 1.1rem;
            opacity: 0.9;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        .register-right {
            flex: 1.2;
            padding: 50px 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-y: auto;
            max-height: 90vh;
        }

        .register-header {
            margin-bottom: 30px;
        }

        .register-header h2 {
            color: #333;
            font-weight: 700;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .register-header p {
            color: #666;
            font-size: 1rem;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group i {
            position: absolute;
            right: 15px;
            top: 43px;
            color: #999;
            cursor: pointer;
            transition: color 0.3s;
        }

        .form-group i:hover {
            color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn-register {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .btn-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-register:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .login-link {
            text-align: center;
            margin-top: 25px;
            color: #666;
        }

        .login-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-size: 0.9rem;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .password-strength {
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0;
            transition: all 0.3s;
        }

        .strength-weak { width: 33%; background: #dc3545; }
        .strength-medium { width: 66%; background: #ffc107; }
        .strength-strong { width: 100%; background: #28a745; }

        @media (max-width: 768px) {
            .register-container {
                flex-direction: column;
                max-width: 500px;
            }

            .register-left {
                order: -1;
                padding: 40px 30px;
            }

            .register-left h2 {
                font-size: 2rem;
            }

            .register-left .icon {
                font-size: 3.5rem;
            }

            .register-right {
                padding: 40px 30px;
            }

            .register-header h2 {
                font-size: 1.5rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container-fluid container-xl">
            <a class="navbar-brand-header" href="../patient/homepage.html">
                <i class="fas fa-clinic-medical me-2"></i>
                <span class="custom-primary-color">Eden</span> Health
            </a>
        </div>
    </nav>

    <!-- Register Section -->
    <div class="register-wrapper">
        <div class="register-container">
            <!-- Left Side -->
            <div class="register-left">
                <div class="icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h2>Tham Gia Với Chúng Tôi!</h2>
                <p>Tạo tài khoản để trải nghiệm dịch vụ chăm sóc sức khỏe toàn diện. Đặt lịch khám, theo dõi sức khỏe và nhận tư vấn từ đội ngũ bác sĩ chuyên nghiệp.</p>
            </div>

            <!-- Right Side - Register Form -->
            <div class="register-right">
                <div class="register-header">
                    <h2>Đăng Ký Tài Khoản</h2>
                    <p>Tạo tài khoản mới của bạn</p>
                </div>

                <div id="registerAlert" class="alert"></div>

                <form id="registerForm">
                    <div class="form-group">
                        <label for="fullname">Họ và tên <span style="color: red;">*</span></label>
                        <input type="text" id="fullname" name="fullname" placeholder="Nhập họ và tên đầy đủ" required>
                        <i class="fas fa-user"></i>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone">Số điện thoại <span style="color: red;">*</span></label>
                            <input type="tel" id="phone" name="phone" placeholder="Nhập số điện thoại" pattern="[0-9]{10,11}" required>
                            <i class="fas fa-phone"></i>
                        </div>

                        <div class="form-group">
                            <label for="gender">Giới tính <span style="color: red;">*</span></label>
                            <select id="gender" name="gender" required>
                                <option value="">Chọn giới tính</option>
                                <option value="nam">Nam</option>
                                <option value="nu">Nữ</option>
                                <option value="khac">Khác</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="birthdate">Ngày sinh <span style="color: red;">*</span></label>
                        <input type="date" id="birthdate" name="birthdate" required>
                        <i class="fas fa-calendar"></i>
                    </div>

                    <div class="form-group">
                        <label for="username">Tên đăng nhập <span style="color: red;">*</span></label>
                        <input type="text" id="username" name="username" placeholder="Nhập tên đăng nhập" required minlength="4">
                        <i class="fas fa-user-circle"></i>
                    </div>

                    <div class="form-group">
                        <label for="password">Mật khẩu <span style="color: red;">*</span></label>
                        <input type="password" id="password" name="password" placeholder="Tạo mật khẩu (tối thiểu 6 ký tự)" required minlength="6">
                        <i class="fas fa-eye password-toggle" onclick="togglePassword('password')"></i>
                        <div class="password-strength">
                            <div class="password-strength-bar" id="strengthBar"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirm_password">Xác nhận mật khẩu <span style="color: red;">*</span></label>
                        <input type="password" id="confirm_password" name="confirm_password" placeholder="Nhập lại mật khẩu" required>
                        <i class="fas fa-eye password-toggle" onclick="togglePassword('confirm_password')"></i>
                    </div>

                    <button type="submit" class="btn-register" id="btnRegister">
                        <i class="fas fa-user-plus me-2"></i>Đăng Ký
                    </button>
                </form>

                <div class="login-link">
                    Đã có tài khoản? <a href="login.html">Đăng nhập ngay</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'http://localhost/DO_AN_1/code_doan1/src/backend/api/auth';

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Password strength checker
        document.getElementById('password').addEventListener('input', function() {
            const password = this.value;
            const strengthBar = document.getElementById('strengthBar');
            
            let strength = 0;
            if (password.length >= 6) strength++;
            if (password.length >= 10) strength++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[^a-zA-Z\d]/.test(password)) strength++;
            
            strengthBar.className = 'password-strength-bar';
            
            if (strength <= 2) {
                strengthBar.classList.add('strength-weak');
            } else if (strength <= 4) {
                strengthBar.classList.add('strength-medium');
            } else {
                strengthBar.classList.add('strength-strong');
            }
        });

        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fullname = document.getElementById('fullname').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const gender = document.getElementById('gender').value;
            const birthdate = document.getElementById('birthdate').value;
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            const btnRegister = document.getElementById('btnRegister');
            
            // Validate
            if (password !== confirmPassword) {
                showAlert('Mật khẩu xác nhận không khớp!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showAlert('Mật khẩu phải có ít nhất 6 ký tự!', 'error');
                return;
            }
            
            if (!/^[0-9]{10,11}$/.test(phone)) {
                showAlert('Số điện thoại không hợp lệ!', 'error');
                return;
            }
            
            if (username.length < 4) {
                showAlert('Tên đăng nhập phải có ít nhất 4 ký tự!', 'error');
                return;
            }

            // Check birthdate
            const today = new Date();
            const birthDate = new Date(birthdate);
            if (birthDate > today) {
                showAlert('Ngày sinh không hợp lệ!', 'error');
                return;
            }
            
            btnRegister.disabled = true;
            btnRegister.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Đang xử lý...';
            
            try {
                const response = await fetch(`${API_BASE}/register.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        fullname: fullname,
                        phone: phone,
                        gender: gender,
                        birthdate: birthdate,
                        username: username,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('Đăng ký thành công! Đang chuyển đến trang đăng nhập...', 'success');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    showAlert(data.message || 'Đăng ký thất bại!', 'error');
                    btnRegister.disabled = false;
                    btnRegister.innerHTML = '<i class="fas fa-user-plus me-2"></i>Đăng Ký';
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Có lỗi xảy ra. Vui lòng thử lại!', 'error');
                btnRegister.disabled = false;
                btnRegister.innerHTML = '<i class="fas fa-user-plus me-2"></i>Đăng Ký';
            }
        });

        function showAlert(message, type) {
            const alert = document.getElementById('registerAlert');
            alert.textContent = message;
            alert.className = 'alert alert-' + type;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>